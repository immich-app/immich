-- NOTE: This file is auto generated by ./sql-generator

-- StackRepository.search
select
  "asset_stack".*,
  "assets"
from
  "asset_stack"
  left join lateral (
    select
      json_agg("asset") as "assets"
    from
      (
        select
          "assets".*,
          to_json("exif") as "exifInfo",
          (
            select
              coalesce(json_agg(agg), '[]')
            from
              (
                select
                  "tags".*
                from
                  "tags"
                  inner join "tag_asset" on "tags"."id" = "tag_asset"."tagsId"
                where
                  "tag_asset"."assetsId" = "assets"."id"
              ) as agg
          ) as "tags"
        from
          "assets"
          inner join "exif" on "assets"."id" = "exif"."assetId"
        where
          "assets"."stackId" = "asset_stack"."id"
        order by
          "assets"."fileCreatedAt" asc
      ) as "asset"
  ) as "asset_lat" on true
where
  "asset_stack"."ownerId" = $1

-- StackRepository.delete
select
  "asset_stack".*,
  "assets"
from
  "asset_stack"
  left join lateral (
    select
      json_agg("asset") as "assets"
    from
      (
        select
          "assets".*,
          to_json("exif") as "exifInfo",
          (
            select
              coalesce(json_agg(agg), '[]')
            from
              (
                select
                  "tags".*
                from
                  "tags"
                  inner join "tag_asset" on "tags"."id" = "tag_asset"."tagsId"
                where
                  "tag_asset"."assetsId" = "assets"."id"
              ) as agg
          ) as "tags"
        from
          "assets"
          inner join "exif" on "assets"."id" = "exif"."assetId"
        where
          "assets"."stackId" = "asset_stack"."id"
        order by
          "assets"."fileCreatedAt" asc
      ) as "asset"
  ) as "asset_lat" on true
where
  "asset_stack"."id" = $1::uuid

-- StackRepository.getById
select
  "asset_stack".*,
  "assets"
from
  "asset_stack"
  left join lateral (
    select
      json_agg("asset") as "assets"
    from
      (
        select
          "assets".*,
          to_json("exif") as "exifInfo",
          (
            select
              coalesce(json_agg(agg), '[]')
            from
              (
                select
                  "tags".*
                from
                  "tags"
                  inner join "tag_asset" on "tags"."id" = "tag_asset"."tagsId"
                where
                  "tag_asset"."assetsId" = "assets"."id"
              ) as agg
          ) as "tags"
        from
          "assets"
          inner join "exif" on "assets"."id" = "exif"."assetId"
        where
          "assets"."stackId" = "asset_stack"."id"
        order by
          "assets"."fileCreatedAt" asc
      ) as "asset"
  ) as "asset_lat" on true
where
  "asset_stack"."id" = $1::uuid
